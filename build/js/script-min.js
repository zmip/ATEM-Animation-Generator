function log(){for(let e=0;e<arguments.length;e++)console.log(arguments[e])}var Generator=function(){var e={debug:0,canvas_padding:100,handleSize:0,curve_handlesize:7,hw:8,hh:4.5,file_version:2,canvas_ctx:0,boxes:[0],canvas_w:0,canvas_h:0,stage:0,clipboard:0,devices:0,data_btns:0,sourcebox:0,tools:0,save_macro_stuff:0,fields:0,curve_presets_elem:0,curve_canvas_elem:0,canvas_elem:0,animation_list_elem:0,device:0,switcher:0,settings:0,macro_index:"",fps:0,current_prop:0,drawfactor:0,pad:0,snapbounds:0,curve_canvas_ctx:0,current_pts:0,old_pts:0,curve_padding:{x:15,y:120},curvesize:400,play_state:0,rendered_frames:0,max_frames:0,interval_hdl:0,play_start:0,current_frame:0,fps_interval:0,playback_skipped:!1,selected:0,clicked:0,curve_clicked:0,cropping:0,scaling:0,lastMouseXY:0,dragOffset:0,oldprops:0,selected_animation:0,animation_presets:{},animations_list:0,init:function(){this.stage="from","undefined"==typeof Storage&&alert("no Web Storage support, use a modern web browser"),this.canvas_elem=document.getElementById("canvas"),this.canvas_ctx=this.canvas_elem.getContext("2d"),this.canvas_ctx.width=this.canvas_elem.width,this.canvas_ctx.height=this.canvas_elem.height,this.canvas_w=this.canvas_elem.width,this.canvas_h=this.canvas_elem.height,this.pad=2,this.drawfactor=this.BMDtoCanvasCoords(16,0).x/(32+this.pad),this.handleSize=21/this.drawfactor,this.curve_canvas_elem=document.getElementById("curve"),this.curve_canvas_ctx=this.curve_canvas_elem.getContext("2d"),this.curve_canvas_ctx.width=this.curve_canvas_elem.width,this.curve_canvas_ctx.height=this.curve_canvas_elem.height,this.transform_fieldset=document.getElementById("transform"),this.fields={from_x:document.getElementById("from_x"),from_y:document.getElementById("from_y"),from_scale:document.getElementById("from_scale"),from_cropL:document.getElementById("from_cropL"),from_cropT:document.getElementById("from_cropT"),from_cropR:document.getElementById("from_cropR"),from_cropB:document.getElementById("from_cropB"),to_x:document.getElementById("to_x"),to_y:document.getElementById("to_y"),to_scale:document.getElementById("to_scale"),to_cropL:document.getElementById("to_cropL"),to_cropT:document.getElementById("to_cropT"),to_cropR:document.getElementById("to_cropR"),to_cropB:document.getElementById("to_cropB"),frames_x:document.getElementById("frames_x"),frames_y:document.getElementById("frames_y"),frames_scale:document.getElementById("frames_scale"),frames_cropL:document.getElementById("frames_cropL"),frames_cropT:document.getElementById("frames_cropT"),frames_cropR:document.getElementById("frames_cropR"),frames_cropB:document.getElementById("frames_cropB"),delay_x:document.getElementById("delay_x"),delay_y:document.getElementById("delay_y"),delay_scale:document.getElementById("delay_scale"),delay_cropL:document.getElementById("delay_cropL"),delay_cropT:document.getElementById("delay_cropT"),delay_cropR:document.getElementById("delay_cropR"),delay_cropB:document.getElementById("delay_cropB")},this.ranges={x:{min:-48,max:48},y:{min:-18,max:27},scale:{min:.001,max:99.99},cropL:{min:0,max:32},cropT:{min:0,max:18},cropR:{min:0,max:32},cropB:{min:0,max:18},frames:{min:1,max:360},delay:{min:0,max:360}},this.boxcolors={1:{bkg:"#286CD7",circle:"#1F55AA"},2:{bkg:"#D55354",circle:"#B54848"},3:{bkg:"#D79328",circle:"#AA741F"},4:{bkg:"#3FBF51",circle:"#36A444"},5:{bkg:"#C64498",circle:"#B13D88"},6:{bkg:"#2BA5BB",circle:"#2692A6"},7:{bkg:"#911eb4",circle:"#841CA3"},8:{bkg:"#9C9ABB",circle:"#8A88A5"}},this.canvas_elem.addEventListener("mousedown",(function(t){e.handleCanvasMouseDown()}),!0),this.canvas_elem.addEventListener("mousemove",(function(t){e.handleCanvasMouseMove()}),!0),this.canvas_elem.addEventListener("mouseup",(function(t){e.handleCanvasMouseUp()}),!0),this.canvas_elem.addEventListener("mouseout",(function(t){e.handleCanvasMouseOut()}),!0),this.curve_canvas_elem.addEventListener("mousedown",(function(t){e.handleCurveMouseDown()}),!0),this.curve_canvas_elem.addEventListener("mousemove",(function(t){e.handleCurveMouseMove()}),!0),this.curve_canvas_elem.addEventListener("mouseup",(function(t){e.handleCurveMouseUp()}),!0),this.curve_canvas_elem.addEventListener("mouseout",(function(t){e.handleCurveMouseOut()}),!0),document.addEventListener("focus",(function(t){e.handleFocus(event)}),!0),document.addEventListener("blur",(function(t){e.handleBlur(event)}),!0),this.transform_fieldset.oninput=function(t){e.handleFieldsChange(event)},this.transform_fieldset.onkeyup=function(t){e.handleFieldsKeyUp(event)},this.transform_fieldset.onmousedown=function(t){e.handleFieldsMouseDown(event)},this.transform_fieldset.onmouseup=function(t){e.handleFieldsMouseUp(event)},this.transform_fieldset.onwheel=function(t){return e.handleFieldsWheel(event)},this.playback_tools=document.getElementById("playback_tools"),this.playback_tools.addEventListener("click",(function(t){e.handleTools(event)}),!0),this.data_btns=document.getElementById("data_btns"),this.data_btns.addEventListener("click",(function(t){e.handleDataBtns(event)}),!0),this.source_select=document.getElementById("source"),this.source_select.addEventListener("change",(function(t){e.handleSourceSelect(event)}),!0),document.getElementById("file_btns").addEventListener("click",(function(t){e.handleFileBtn(event)}),!0),document.getElementById("upload_file").onchange=function(t){e.loadFile(t)},this.curve_presets_elem=document.getElementById("curve_presets"),this.curve_presets_elem.addEventListener("click",(function(t){e.handleCurvePresetBtn(t)}),!0),this.save_macro_stuff=document.getElementById("save_macro"),this.save_macro_stuff.onkeyup=function(t){e.handleSaveMacro(t)},this.save_macro_stuff.onclick=function(t){e.handleSaveMacro(t)},this.animations_list_elem=document.getElementById("animationlist"),this.animations_list=[0],this.animations_list_elem.onmousedown=function(t){return e.handleAnimationSelectList(t)},this.animations_list_elem.onkeydown=function(t){return e.handleAnimationSelectList(t)},this.animations_list_elem.ondblclick=function(t){return e.loadAnimation(e.selected_animation)},document.getElementById("animationlist_btns").onclick=function(t){return e.handleAnimationListBtns(t)},document.getElementById("header").addEventListener("change",(function(t){e.handleMainMenu(t)}),!0),document.getElementById("boxes").addEventListener("change",(function(t){e.handleBoxToggles(t)}),!0),this.devices=this.getDevices();var t=document.getElementById("device");for(device in this.devices){var s=document.createElement("option");s.id=device,s.innerHTML=this.devices[device].name,t.appendChild(s)}this.restoreState(),this.setMenuOptions(),this.redrawScreen(),this.drawCurve(),this.debug;var i=this;window.addEventListener("mouseup",(function(e){i.clicked?i.handleCanvasMouseUp():i.curve_clicked&&i.handleCurveMouseUp()})),window.addEventListener("beforeunload",(function(e){i.saveState(!1),delete e.returnValue}),!1),window.addEventListener("resize",(function(e){}),!0)},handleCanvasMouseDown:function(){var e,t,s=this.getMouseXY(),i=0;if(this.clicked=0,this.lastMouseXY=s,this.selected&&(t=this.boxes[this.selected][this.stage],e=this.getBoxBounds(t,!0,!0),this.oldprops={...t},this.hitTest(s,e)&&(this.clicked=this.selected),i=this.getHandle(s)))if(i.indexOf("crop")>=0){var a;this.cropping=i,"crop21"==i?a="cropR":"crop01"==i?a="cropL":"crop10"==i?a="cropT":"crop12"==i&&(a="cropB");var r=this.fields[this.stage+"_"+a];this.focusRow(r,a)}else{this.scaling=i;r=this.fields[this.stage+"_scale"];this.focusRow(r,"scale")}else{if(0==this.clicked)for(var n=this.boxes.length,o=1;o<n;o++)if(this.boxes[o].enabled&&(t=this.boxes[o][this.stage],this.oldprops={...t},e=this.getBoxBounds(t,!1),this.hitTest(s,e))){this.clicked=o;break}this.clicked?(this.selected&&this.blurRow(),this.focusCanvasElement()):this.blurCanvasElement(),this.redrawScreen()}},handleCanvasMouseMove:function(){var e=this.getMouseXY();if(this.selected&&this.setCursor(e),0!=this.clicked){props=this.boxes[this.clicked][this.stage];props.x,props.cropL,props.scale,props.y,props.cropT,props.scale;var t,s=e.x-this.lastMouseXY.x,i=e.y-this.lastMouseXY.y;if(s||i)if(0!==this.cropping){var a=.3/props.scale;"crop01"==this.cropping?(t=Math.min(4*this.hw-this.oldprops.cropR,Math.max(0,this.oldprops.cropL+s/this.oldprops.scale)))>=16-a&&t<16+a&&(t=16):"crop10"==this.cropping?(t=Math.min(4*this.hh-this.oldprops.cropB,Math.max(0,this.oldprops.cropT-i/this.oldprops.scale)))>=9-a&&t<9+a&&(t=9):"crop21"==this.cropping?(t=Math.min(4*this.hw-this.oldprops.cropL,Math.max(0,this.oldprops.cropR-s/this.oldprops.scale)))>=16-a&&t<16+a&&(t=16):"crop12"==this.cropping&&(t=Math.min(4*this.hh-this.oldprops.cropT,Math.max(0,this.oldprops.cropB+i/this.oldprops.scale)))>=9-a&&t<9+a&&(t=9);var r=!1;this.floatsEqual(props[this.current_prop],t)||(r=!0),props[this.current_prop]=t,this.updateFields({[this.current_prop]:t},this.stage),r&&this.drawCurve()}else if(0!==this.scaling){var n=this.oldprops.x+16*this.oldprops.scale,o=this.oldprops.y+9*this.oldprops.scale,c=n-props.x,h=o-props.y,l=h/c;if(Math.abs(e.y-props.y)/Math.abs(e.x-props.x)>l)d=Math.abs(e.x-props.x);else var d=Math.abs(e.y-props.y)*(c/h);props.scale=Math.max(this.ranges.scale.min,Math.min(this.ranges.scale.max,d*this.oldprops.scale/c)),this.updateFields({scale:props.scale},this.stage)}else{var p=this.checkSnap(this.oldprops.x+s,this.oldprops.y+i);props.x=p.x,props.y=p.y,this.updateFields({x:p.x,y:p.y},this.stage)}this.redrawScreen()}},getSnapBounds:function(e){return{l:(16-e.cropL)*e.scale-16,t:9+(-9+e.cropT)*e.scale,r:16-(16-e.cropR)*e.scale,b:(9-e.cropB)*e.scale-9}},checkSnap:function(e,t){var s=.3;return e>=-.3&&e<s?e=0:e>=this.snapbounds.l-s&&e<this.snapbounds.l+s?e=this.snapbounds.l:e<=this.snapbounds.r+s&&e>this.snapbounds.r-s&&(e=this.snapbounds.r),t>-.3&&t<s&&(t=0),t>=this.snapbounds.t-s&&t<this.snapbounds.t+s?t=this.snapbounds.t:t<=this.snapbounds.b+s&&t>this.snapbounds.b-s&&(t=this.snapbounds.b),{x:e,y:t}},handleCanvasMouseUp:function(){if(0!=this.clicked){0!==this.cropping||this.scaling,this.clicked=0,this.cropping=0,this.scaling=0,this.dragOffset=0;var e=this.getMouseXY();this.setCursor(e),this.redrawScreen(),this.saveState(!0)}},handleCanvasMouseOut:function(){},handleFocus:function(e){if(this.selected){var t=e.target;if(t.closest("#transform")){var s,i,a=t.parentElement.classList;[s,i]=t.id.split("_"),(a.contains("from-input")||a.contains("to-input"))&&this.setStage(s),this.focusRow(t,i)}}},handleBlur:function(e){this.selected&&e.target.closest("#transform")},focusRow:function(e,t){var s=this.transform_fieldset.querySelector(".current_prop");s&&s!==e&&s.classList.remove("current_prop"),e.classList.add("current_prop");var i=e.closest("tr");if(!i.classList.contains("row-focus")){var a=this.transform_fieldset.querySelector(".row-focus");a&&a.classList.remove("row-focus"),i.classList.add("row-focus"),this.current_pts=this.boxes[this.selected].curves[t],this.current_prop=t,this.drawCurve()}},blurRow:function(){var e=this.transform_fieldset.querySelector(".row-focus");e&&e.classList.remove("row-focus");var t=this.transform_fieldset.querySelector(".current_prop");t&&(t.classList.remove("current_prop"),this.setFieldEditable(t,!1)),this.current_prop=0,this.drawCurve()},updateFields:function(e,t){for(var s in e){var i=t+"_"+s;if(i in this.fields){var a=e[s];"number"==typeof a&&"frames"!==t&&"delay"!==t&&(a=a.toFixed(3)),this.fields[i].value=a}}},handleFieldsChange:function(e,t){if(this.selected){var s,i,a,r=e.target,n=r.value;[i,a]=r.id.split("_"),"frames"==i||"delay"==i?(n=parseInt(n),isNaN(n)&&(n=this.ranges[i].min),s=Math.max(this.ranges[i].min,Math.min(this.ranges[i].max,n)),t||(r.value=s)):(n=parseFloat(n),isNaN(n)?s=this.boxes[this.selected][i][a]:(s=Math.max(this.ranges[a].min,Math.min(this.ranges[a].max,+n)))==n||t||(r.value=s.toFixed(3))),this.boxes[this.selected][i][a]=s,this.redrawScreen(),this.drawCurve(),this.saveState(!0)}},setFieldEditable:function(e,t){t?(e.classList.add("selectable"),e.readOnly=!1):(e.classList.remove("selectable"),e.readOnly=!0)},handleFieldsKeyUp:function(e){if(this.selected){var t=e.target;this.handleFieldsChange(e,!0),"Enter"!==e.key&&13!==e.keyCode||t.select()}},handleFieldsMouseDown:function(e){if(!this.selected)return!1;var t=e.target;return document.activeElement==t&&this.setFieldEditable(t,!0),!1},handleFieldsMouseUp:function(e){return!0},handleFieldsWheel:function(e){if(!this.selected)return!0;var t=e.target;if("text"==t.type&&t===document.activeElement){var s;if([i,s]=t.id.split("_"),"frames"==i||"delay"==i){var i=this.boxes[this.selected][i],a=.01*event.deltaY;a=a>0?Math.max(1,a):Math.min(-1,a),t.value=i[s]+a}else{var r,n=this.boxes[this.selected][this.stage];r="scale"==s?-1e-4*n[s]:-.0025,"y"==s&&(r=-r),t.value=n[s]+event.deltaY*r}return this.handleFieldsChange({target:t}),!1}return!0},handleTools:function(e){var t=e.target;if("from_btn"==t.id)this.setStage("from");else if("to_btn"==t.id)this.setStage("to");else if("play_btn"==t.id)0==this.play_state?this.play():this.stop(!0);else if(t.id.startsWith("fpsbtn_")){var s=t.id.split("_")[1];if(this.fps==s)return;this.fps=s,this.setFPSbtns(),this.saveState(!0),this.play_state&&(this.stop(),this.play())}},setFPSbtns:function(){var e=this.playback_tools.querySelector("#fpsbtns .toggled");e&&e.classList.remove("toggled"),this.playback_tools.querySelector("#fpsbtn_"+this.fps).classList.add("toggled")},handleSourceSelect:function(e){if(this.selected){var t=e.target,s=t.options[t.selectedIndex].id;this.boxes[this.selected].src="none"==s?0:s,this.redrawScreen()}},handleDataBtns:function(e){if(this.selected){var t=e.target,s=this.boxes[this.selected][this.stage];if("reset_scale_btn"==t.id)s.scale=1;else if("reset_crop_btn"==t.id)s.cropL=s.cropT=s.cropR=s.cropB=0;else{if("reverse_btn"==t.id){var i={...this.boxes[this.selected].from};for(prop in this.boxes[this.selected].from=this.boxes[this.selected].to,this.boxes[this.selected].to=i,this.boxes[this.selected].curves){var a={...this.boxes[this.selected].curves[prop].p1},r={...this.boxes[this.selected].curves[prop].p2};this.boxes[this.selected].curves[prop].p1={x:1-r.x,y:1-r.y},this.boxes[this.selected].curves[prop].p2={x:1-a.x,y:1-a.y}}return this.updateFields(this.boxes[this.selected].to,"to"),this.updateFields(this.boxes[this.selected].from,"from"),"from"!=this.stage?this.setStage("from"):this.redrawScreen(),void this.drawCurve()}if("copy_btn"==t.id)this.clipboard=this.deepClone(this.boxes[this.selected]),document.getElementById("paste_btn").disabled=!1;else if("paste_btn"==t.id)this.boxes[this.selected].from=this.deepClone(this.clipboard.from),this.boxes[this.selected].to=this.deepClone(this.clipboard.to),this.boxes[this.selected].delay=this.deepClone(this.clipboard.delay),this.boxes[this.selected].frames=this.deepClone(this.clipboard.frames),this.boxes[this.selected].curves=this.deepClone(this.clipboard.curves),this.setStage("from");else{var n=t.id.split("_");if("pos"==n[1]){var o,c,h=n[2].charAt(0)-1,l=-(n[2].charAt(1)-1);o=h<0?16*h+(16-s.cropL)*-h*s.scale:16*h+(16-s.cropR)*-h*s.scale,c=l<0?9*l+(9-s.cropB)*-l*s.scale:9*l+(9-s.cropT)*-l*s.scale,s.x=o,s.y=c}}}this.updateFields(this.boxes[this.selected][this.stage],this.stage),this.drawCurve(),this.redrawScreen()}},handleMainMenu:function(e){var t=e.target;return this.blurCanvasElement(),"device"==t.id?(this.device=t.options[t.selectedIndex].id,this.switcher="ME1",this.setMenuOptions(),this.setupProps(),this.saveState(!0)):"switcher"==t.id&&(this.switcher=t.options[t.selectedIndex].id,this.setupProps(),this.saveState(!0)),"from"!=this.stage?this.setStage("from"):this.redrawScreen(),!1},setMenuOptions:function(){document.getElementById("device").querySelector("#"+this.device).selected=!0;var e,t=document.getElementById("switcher");t.querySelector("#"+this.switcher).selected=!0;for(var s=this.getDeviceCapabilities(this.device),i=0;i<4;i++)e=t.options[i],i>=s.switchers?e.disabled=!0:(e.value==this.switcher&&(e.selected="selected"),e.disabled=!1);for(1==s.switchers?(t.disabled=!0,t.querySelector("option").selected=!1,t.options[0].selected=!0):t.disabled=!1,i=this.source_select.length;i>=1;i--)this.source_select.remove(i);for((a=document.createElement("option")).id="Black",a.innerHTML="Black",this.source_select.appendChild(a),i=1;i<=s.cameras;i++){(a=document.createElement("option")).id="Camera"+i,a.innerHTML="Camera "+i,this.source_select.appendChild(a)}for((a=document.createElement("option")).id="ColorBars",a.innerHTML="Color Bars",this.source_select.appendChild(a),i=1;i<=s.colors;i++){(a=document.createElement("option")).id="Color"+i,a.innerHTML="Color "+i,this.source_select.appendChild(a)}for(i=1;i<=s.mediaplayers;i++){(a=document.createElement("option")).id="MediaPlayer"+i,a.innerHTML="Media Player "+i,this.source_select.appendChild(a),(a=document.createElement("option")).id="MediaPlayer"+i+"Key",a.innerHTML="Media Player "+i+" Key",this.source_select.appendChild(a)}for(i=1;i<=s.supersource;i++){var a;(a=document.createElement("option")).id="SuperSource",a.innerHTML="Supersource",this.source_select.appendChild(a)}this.setFPSbtns(),this.save_macro_stuff.querySelector("#macro_index").value=this.macro_index},getDeviceCapabilities:function(e){return this.devices[e]},handleBoxToggles:function(e){var t=e.target.value;this.boxes[t].enabled=e.target.checked,this.selected!=t||e.target.checked?e.target.checked&&(this.clicked=t,this.selected=this.clicked,this.focusCanvasElement(),this.clicked=0):this.handleCanvasMouseDown(),this.redrawScreen(),this.saveState(!0)},focusCanvasElement:function(){this.selected=this.clicked,this.transform_fieldset.disabled=!1,this.data_btns.disabled=!1,this.source_select.disabled=!1;var e=this.source_select.namedItem(this.boxes[this.selected].src);e?e.selected=!0:this.source_select.namedItem("none").selected=!0,this.updateFields(this.boxes[this.selected].from,"from"),this.updateFields(this.boxes[this.selected].to,"to"),this.updateFields(this.boxes[this.selected].delay,"delay"),this.updateFields(this.boxes[this.selected].frames,"frames"),this.snapbounds=this.getSnapBounds(this.boxes[this.selected][this.stage])},blurCanvasElement:function(){this.selected=0,this.transform_fieldset.disabled=!0,this.data_btns.disabled=!0,this.source_select.disabled=!0,this.source_select.selectedIndex=0;var e={label:"",i:"",x:"",y:"",scale:"",cropL:"",cropT:"",cropR:"",cropB:""};this.updateFields(e,"from"),this.updateFields(e,"to"),this.updateFields(e,"delay"),this.updateFields(e,"frames"),document.activeElement.blur(),this.blurRow()},setStage:function(e){if("to"==e&&"to"!==this.stage||"from"==e&&"from"!==this.stage){if(this.stage=e,this.redrawScreen(),this.playback_tools.querySelector("#from_btn").classList.toggle("toggled"),this.playback_tools.querySelector("#to_btn").classList.toggle("toggled"),this.transform_fieldset.querySelector("#from_th").classList.toggle("col-focus"),this.transform_fieldset.querySelector("#to_th").classList.toggle("col-focus"),this.current_prop){var t=this.fields[this.stage+"_"+this.current_prop];this.focusRow(t,this.current_prop)}}else this.redrawScreen()},getMouseXY:function(){return this.mouseToBMDcoords()},mouseToBMDcoords:function(){var e=window.event,t=e.offsetX/e.target.offsetWidth,s=e.offsetY/e.target.offsetHeight,i=this.pad+this.pad;return{x:t*(32+i)-(16+this.pad),y:-(s*(18+i)-(9+this.pad))}},BMDtoCanvasCoords:function(e,t){var s=this.pad+this.pad;return{x:e=Math.round(this.canvas_w/2+e*(this.canvas_w/(32+s))),y:t=Math.round(this.canvas_h/2+-t*(this.canvas_h/(18+s)))}},getBoxBounds:function(e,t,s){var i;i=s?.5*this.handleSize:0;var a=16*e.scale,r=9*e.scale;return 1==t?{l:e.x-i-a,t:e.y+i+r,r:e.x+a+i,b:e.y-r-i}:{l:e.x-a+e.cropL*e.scale-i,t:e.y+r-e.cropT*e.scale+i,r:e.x+a-e.cropR*e.scale+i,b:e.y-r+e.cropB*e.scale-i}},hitTest:function(e,t){return e.x>=t.l&&e.x<t.r&&e.y<=t.t&&e.y>t.b},hitTestCurve:function(e,t){return e.x>=t.l&&e.x<t.r&&e.y>=t.t&&e.y<t.b},getHandle:function(e){if(0!=this.selected){for(var t,s,i,a=this.getBoxBounds(this.boxes[this.selected][this.stage],!0,!0),r=.5*(a.r-a.l-this.handleSize),n=.5*(a.t-a.b-this.handleSize),o=this.getBoxBounds(this.boxes[this.selected][this.stage],!1,!0),c=.5*(o.r-o.l-this.handleSize),h=.5*(o.t-o.b-this.handleSize),l=0;l<3;l++)for(var d=0;d<3;d++)if(1!=l||1!=d){1==l||1==d?(t=o,s=c,i=h):(t=a,s=r,i=n);var p=t.l+l*s,u=t.t-d*i,m=p+this.handleSize,v=u-this.handleSize;if(this.hitTest(e,{l:p,t:u,r:m,b:v}))return l%2||d%2?"crop"+l+d:"scale"+l+d}return 0}},setCursor:function(e){var t=this.getHandle(e);if(0!==t)"crop21"==t?this.canvas_elem.style.cursor="w-resize":"crop01"==t?this.canvas_elem.style.cursor="e-resize":"crop10"==t?this.canvas_elem.style.cursor="s-resize":"crop12"==t?this.canvas_elem.style.cursor="n-resize":"scale22"==t?this.canvas_elem.style.cursor="nw-resize":"scale00"==t?this.canvas_elem.style.cursor="se-resize":"scale20"==t?this.canvas_elem.style.cursor="sw-resize":"scale02"==t&&(this.canvas_elem.style.cursor="ne-resize");else{var s=this.getBoxBounds(this.boxes[this.selected][this.stage],!0,!0);this.hitTest(e,s)?this.canvas_elem.style.cursor="move":0==this.clicked&&(this.canvas_elem.style.cursor="default")}},redrawScreen:function(e){var t=this.canvas_ctx;e||(e=this.boxes),t.clearRect(0,0,t.width,t.height);for(var s=0,i=0,a=e.length-1;a>0;a--)e[a].enabled&&(i=this.drawBox(t,e[a]),a==this.selected&&(s=i));if(t.fillStyle="rgba(0,0,0,0.6)",padpx=Math.round(this.pad*this.drawfactor),t.fillRect(0,0,t.width,padpx),t.fillRect(0,t.height-padpx,t.width,padpx),t.fillRect(0,padpx,padpx,t.height-padpx-padpx),t.fillRect(t.width-padpx,padpx,padpx,t.height-padpx-padpx),t.fillStyle="rgba(0,0,0,0.2)",t.fillRect(0,.5*t.height-1,t.width,2),t.fillRect(.5*t.width-1,0,2,t.height),0===this.play_state&&0!==s){var r=s.l,n=s.t,o=s.cw,c=s.ch;t.strokeStyle="white",t.setLineDash([]),t.fillStyle="white",t.lineWidth=4,t.strokeRect(r+2,n+2,o-2,c-2),t.setLineDash([10,10]),t.lineWidth=2,t.strokeRect(s.x-s.w+1,s.y-s.h+1,2*s.w-2,2*s.h-2),t.fillStyle="#FFF";for(var h=Math.round(this.handleSize*this.drawfactor),l=.5*h,d=-1;d<2;d++)for(var p=-1;p<2;p++)0==d&&0==p?(t.fillRect(s.x-20,s.y-2,40,4),t.fillRect(s.x-2,s.y-20,4,40)):0==d||0==p?(t.fillStyle="#BBB",t.fillRect(r+.5*o*(d+1)-l+2,n+.5*c*(p+1)-l+2,h-4,h-4),t.fillStyle="#FFF"):t.fillRect(s.x-s.w*d-l,s.y-s.h*p-l,h,h)}},drawBox:function(e,t){var s,i=t.i;s=this.play_state&&t.at?t.at:t[this.stage];var a=this.BMDtoCanvasCoords(s.x,s.y),r=Math.round(16*s.scale*this.drawfactor),n=Math.round(9*s.scale*this.drawfactor),o=Math.round(a.x-r+s.cropL*s.scale*this.drawfactor),c=Math.round(a.y-n+s.cropT*s.scale*this.drawfactor),h=Math.round(a.x+r-s.cropR*s.scale*this.drawfactor-o),l=Math.round(a.y+n-s.cropB*s.scale*this.drawfactor-c);e.fillStyle=this.boxcolors[i].bkg,e.fillRect(o,c,h,l),e.save();var d=new Path2D;return d.rect(o,c,h,l),e.clip(d),e.beginPath(),e.arc(a.x,a.y,n,0,2*Math.PI,!1),e.fillStyle=this.boxcolors[i].circle,e.fill(),e.fillStyle="#000",e.fillRect(o,a.y-1,h,2),e.fillRect(a.x-1,c,2,l),e.fillStyle="#FFF",e.font="bold "+300*s.scale+"px sans-serif",e.textAlign="center",e.fillText(t.label,a.x,a.y+60*s.scale),e.restore(),t.i!=this.selected||this.play_state?(e.setLineDash([]),e.strokeStyle="#3854AC",e.fillStyle=e.strokeStyle,e.lineWidth=4,e.strokeRect(o+2,c+2,h-2,l-2)):e.fillStyle="white",e.font="36px sans-serif",e.textAlign="left",e.fillText(t.label,o+20,c+50),0!=t.src&&(e.font="28px sans-serif",e.fillText(t.src,o+20,c+85)),{l:o,t:c,cw:h,ch:l,x:a.x,y:a.y,w:r,h:n}},storeData:function(e,t){0===t?window.localStorage.removeItem(e):window.localStorage.setItem(e,JSON.stringify(t))},retrieveData:function(e){var t=window.localStorage.getItem(e);return(t=JSON.parse(t))&&"object"==typeof t?t:0},saveState:function(e){e||this.storeData("settings",this.getStateStorageStruct())},restoreState:function(e){e?(stored_state=e.state,+stored_state.version!=this.file_version?(alert("File version ("+parseInt(stored_state.version)+") doesn't match current ("+this.file_version+"), sorry"),stored_state=0):this.animation_presets=e.animations):(stored_state=this.retrieveData("settings"),this.animation_presets=this.retrieveData("animations")),stored_state&&+stored_state.version==this.file_version?(this.device=stored_state.device,this.switcher=stored_state.switcher,this.settings=stored_state.settings,this.fps=stored_state.fps,this.macro_index=stored_state.macro_index):this.settings={},this.animation_presets||(this.animation_presets={}),this.setupProps()},setupProps:function(){this.boxes=[0],this.device in this.settings&&this.switcher in this.settings[this.device]?this.boxes=this.settings[this.device][this.switcher]:(0===this.device&&(this.device="mini"),0==this.switcher&&(this.switcher="ME1"),0==this.fps&&(this.fps=30),this.device in this.settings||(this.settings[this.device]={}),this.switcher in this.settings[this.device]||(this.settings[this.device][this.switcher]={}),this.settings[this.device][this.switcher]=this.boxes);var e=this.getDeviceCapabilities(this.device),t={keyers:e.keyers,supersource:e.supersource?4:0};this.device in this.animation_presets&&this.switcher in this.animation_presets[this.device]||(this.device in this.animation_presets||(this.animation_presets[this.device]={}),this.switcher in this.animation_presets[this.device]||(this.animation_presets[this.device][this.switcher]={}),this.animation_presets[this.device][this.switcher]=this.getAnimationPresets(e,this.switcher)),this.animations_list=this.animation_presets[this.device][this.switcher],this.updateAnimationList();var s=1;for(var a in t){for(var r=document.getElementById(a);r.firstChild;)r.removeChild(r.lastChild);var n="";for(i=1;i<=t[a];i++)n+='<input class="nobox" type="checkbox" id="box'+s+'" value="'+s+'"><label class="boxlabel btn" for="box'+s+'">'+i+"</label>",s++;t[a]||(n="N/A"),r.innerHTML=n}1==this.boxes.length&&this.animations_list.length?this.loadAnimation(1):(this.fillBoxes(),this.setBoxToggles())},fillBoxes:function(){var e,t,s=this.getDeviceCapabilities(this.device),i=s.keyers;if((e=i+(s.supersource?4:0))!=this.boxes.length-1){for(var a=[],r=[],n=this.boxes.length,o=1;o<n;o++)"keyers"==this.boxes[o].type?a.push(this.boxes[o]):r.push(this.boxes[o]);this.boxes.splice(1);var c=1==n,h=1,l=1;8==e?(h=3,l=3):6==e?(h=2,l=3):4==e?(h=2,l=2):2==e&&(h=1,l=2);var d=32/l,p=18/h,u=Math.min(.5,1/l),m=0,v=0;for(o=1;o<=e;o++){o>i?(t="box"+(o-i),type="supersource"):(t="key"+o,type="keyers");var f=0;o<=i&&a.length?f=a.splice(0,1)[0]:o>i&&r.length&&(f=r.splice(0,1)[0]),f?(f.i=o,f.type=type,this.boxes.push(f)):(3==l?m=(o-1)%l*d-1*d:2==l&&(m=(o-1)%l*d-.5*d),2==h?v=-Math.floor(o/(l+1))*p- -.5*p:3==h&&(v=-Math.floor((o-1)/l-.5+.5)*p+p),this.boxes.push({i:o,label:t,enabled:c,src:0,type:type,from:{x:m,y:v,scale:u,cropL:0,cropT:0,cropR:0,cropB:0},to:{x:0,y:0,scale:1,cropL:0,cropT:0,cropR:0,cropB:0},at:0,delay:{x:0,y:0,scale:0,cropL:0,cropT:0,cropR:0,cropB:0},frames:{x:20,y:20,scale:20,cropL:20,cropT:20,cropR:20,cropB:20},curves:{x:{p1:{x:.37,y:0},p2:{x:.63,y:1}},y:{p1:{x:.37,y:0},p2:{x:.63,y:1}},scale:{p1:{x:.37,y:0},p2:{x:.63,y:1}},cropL:{p1:{x:.37,y:0},p2:{x:.63,y:1}},cropT:{p1:{x:.37,y:0},p2:{x:.63,y:1}},cropR:{p1:{x:.37,y:0},p2:{x:.63,y:1}},cropB:{p1:{x:.37,y:0},p2:{x:.63,y:1}}}}))}}},getCurveMouseXY:function(){var e=window.event,t=this.curvesize+2*this.curve_padding.x,s=this.curvesize+2*this.curve_padding.y,i=(t-2*this.curve_padding.x)/e.target.offsetWidth,a=(s-2*this.curve_padding.y)/e.target.offsetHeight;return{x:e.offsetX*i-this.curve_padding.x,y:e.offsetY*a-this.curve_padding.y}},handleCurveMouseDown:function(){if(0!==this.current_pts&&!this.curve_clicked){var e=this.getCurveMouseXY(),t=this.curvesize-2*this.curve_padding.x,s=this.curvesize-2*this.curve_padding.y;this.old_pts={...this.current_pts};var i=this.current_pts.p1.x*t,a=(1-this.current_pts.p1.y)*s,r={x:this.current_pts.p2.x*t,y:(1-this.current_pts.p2.y)*s};if(this.hitTestCurve(e,{l:i-this.curve_handlesize,t:a-this.curve_handlesize,r:i+this.curve_handlesize,b:a+this.curve_handlesize}))this.curve_clicked=1,this.lastMouseXY=e;else{r={x:this.current_pts.p2.x*t,y:(1-this.current_pts.p2.y)*s};this.hitTestCurve(e,{l:r.x-this.curve_handlesize,t:r.y-this.curve_handlesize,r:r.x+this.curve_handlesize,b:r.y+this.curve_handlesize})&&(this.curve_clicked=2,this.lastMouseXY=e)}}},handleCurveMouseMove:function(){if(this.curve_clicked){var e=this.curvesize-2*this.curve_padding.x,t=this.curvesize-2*this.curve_padding.y,s=this.getCurveMouseXY(),i=s.x-this.lastMouseXY.x,a=this.lastMouseXY.y-s.y;if(1==this.curve_clicked){var r=Math.max(this.old_pts.p1.x+i/e,0);this.current_pts.p1={x:r,y:this.old_pts.p1.y+a/t}}else if(2==this.curve_clicked){r=Math.min(this.old_pts.p2.x+i/e,1);this.current_pts.p2={x:r,y:this.old_pts.p2.y+a/t}}this.drawCurve()}},handleCurveMouseUp:function(){this.curve_clicked=0},handleCurveMouseOut:function(){},loadAnimation:function(e){var t;this.stop(),t=void 0===this.animations_list[e]?[0]:this.deepClone(this.animations_list[e].boxes),this.settings[this.device][this.switcher]=t,this.boxes=t,this.fillBoxes(),this.setBoxToggles(),this.setStage("from"),this.play()},play:function(){var e=this.selected;this.selected=0,this.setStage("from"),this.selected=e,this.play_state=1,document.getElementById("play_btn").classList.add("playing");var t=this.renderFrames();this.rendered_frames=t.rendered_frames,this.max_frames=t.max_frames;var s=this;this.current_frame=-1,this.interval_hdl=setInterval((function(){s.updateFrame()}),5),this.play_start=Date.now()+250,this.fps_interval=1e3/this.fps,this.playback_skipped=!1},stop:function(e){clearInterval(this.interval_hdl),this.play_state=0,document.getElementById("play_btn").classList.remove("playing"),e?this.setStage(this.stage):this.setStage("to"),this.redrawScreen()},updateFrame:function(){var e=Date.now()-this.play_start,t=Math.round(e/this.fps_interval);if(!(t<=this.current_frame||t<0))if(t>this.current_frame+1&&(this.playback_skipped=!0),this.current_frame=t,this.current_frame<this.max_frames){var s=this.rendered_frames.length;for(i=1;i<s;i++){var a=this.rendered_frames[i];for(prop in a){var r=a[prop];t<r.length&&(this.boxes[i].at[prop]=r[this.current_frame])}}this.redrawScreen(),ctx=this.canvas_ctx,ctx.fillStyle=this.playback_skipped?"#D00":"#FFF",ctx.font="40px monospace",ctx.textAlign="right",ctx.fillText(String("000"+this.current_frame).slice(-3),this.canvas_w-30,this.canvas_h-30)}else this.stop(!1)},renderFrames:function(){rendered_frames=[0];for(var e,t,s,i=this.boxes.length,a=["x","y","scale","cropL","cropT","cropR","cropB"],r=0,n=a.length,o=1;o<i;o++){var c={};if(this.boxes[o].enabled){e=this.boxes[o].from,t=this.boxes[o].to;for(var h=0;h<n;h++){c[s=a[h]]=[];var l=this.boxes[o].from[s];if(c[s].push(e[s]),!this.floatsEqual(e[s],t[s])){this.boxes[o].at={...e};for(var d=0;d<this.boxes[o].delay[s];d++)c[s].push(e[s]);var p=this.boxes[o].frames[s],u=this.renderCurveValues(this.boxes[o].curves[s],p),m=this.boxes[o].to[s];for(d=1;d<=p;d++){var v=Math.max(this.ranges[s].min,Math.min(this.ranges[s].max,this.lerp(l,m,u[d])));c[s].push(v)}r=Math.max(r,c[s].length)}}rendered_frames.push(c)}else rendered_frames.push(0)}return{rendered_frames:rendered_frames,max_frames:r}},floatsEqual:function(e,t){return Math.abs(e-t)<.05},bezier:function(e,t,s,i,a){var r=3*(s.x-t.x),n=3*(i.x-s.x)-r,o=a.x-t.x-r-n,c=3*(s.y-t.y),h=3*(i.y-s.y)-c,l=a.y-t.y-c-h;return{x:o*Math.pow(e,3)+n*Math.pow(e,2)+r*e+t.x,y:l*Math.pow(e,3)+h*Math.pow(e,2)+c*e+t.y}},drawCurve:function(){var e=this.curve_canvas_ctx,t=this.current_pts;e.clearRect(0,0,this.curvesize,this.curvesize),e.fillStyle="#555",e.fillRect(this.curve_padding.x,this.curve_padding.y,this.curvesize-2*this.curve_padding.x,this.curvesize-2*this.curve_padding.y),e.fillStyle="#AAA",e.font="18px sans-serif",e.fillText(this.current_prop,this.curve_padding.x,30);var s=this.curvesize-2*this.curve_padding.x,i=this.curvesize-2*this.curve_padding.y;e.strokeStyle="#777";for(var a=(this.curvesize-2*this.curve_padding.y)/4,r=1;r<4;r++)e.beginPath(),e.moveTo(this.curve_padding.x,this.curve_padding.y+r*a),
e.lineTo(this.curvesize-this.curve_padding.x,this.curve_padding.y+r*a),e.stroke();if(this.current_prop){this.selected||alert("CURRENT PROP BUT NO SELECTION");var n=Math.min(20,this.boxes[this.selected].frames[this.current_prop]),o=(this.curvesize-2*this.curve_padding.x)/n;for(r=1;r<n;r++)e.beginPath(),e.moveTo(this.curve_padding.x+r*o,this.curve_padding.y),e.lineTo(this.curve_padding.x+r*o,this.curvesize-this.curve_padding.y),e.stroke();var c=this.boxes[this.selected],h=c.to[this.current_prop],l=c.from[this.current_prop];if(this.floatsEqual(h,l)){this.curve_presets_elem.disabled=!0;var d={x:this.curve_padding.x,y:this.curve_padding.y+1*i},p={x:this.curvesize-this.curve_padding.x,y:this.curvesize-this.curve_padding.y};return this.drawPoint(e,d,6,"#AAA"),this.drawPoint(e,p,6,"#AAA"),e.strokeStyle="#FFF",e.beginPath(),e.moveTo(d.x,d.y),e.lineTo(p.x,p.y),void e.stroke()}this.curve_presets_elem.disabled=!1,e.strokeStyle="#999",e.beginPath(),e.moveTo(this.curve_padding.x,this.curve_padding.y+1*i),e.lineTo(this.curve_padding.x+t.p1.x*s,this.curve_padding.y+(1-t.p1.y)*i),e.stroke(),e.beginPath(),e.moveTo(this.curve_padding.x+t.p2.x*s,this.curve_padding.y+(1-t.p2.y)*i),e.lineTo(this.curve_padding.x+s,this.curve_padding.y),e.stroke(),e.fillStyle="#FFF",e.fillRect(this.curve_padding.x+t.p1.x*s-this.curve_handlesize/2,this.curve_padding.y+(1-t.p1.y)*i-this.curve_handlesize/2,this.curve_handlesize,this.curve_handlesize),e.fillRect(this.curve_padding.x+t.p2.x*s-this.curve_handlesize/2,this.curve_padding.y+(1-t.p2.y)*i-this.curve_handlesize/2,this.curve_handlesize,this.curve_handlesize),e.beginPath(),e.strokeStyle="#FFF",e.moveTo(this.curve_padding.x,this.curve_padding.y+1*i);var u=this.renderCurveValues(t,n),m=u.length,v=1/n;for(r=0;r<m;r++){var f=this.getCurveCanvasPoint({x:r*v,y:u[r]});e.lineTo(f.x,f.y),this.drawPoint(e,f,6,"#AAA")}e.lineTo(this.curvesize-this.curve_padding.x,this.curve_padding.y),e.stroke(),e.font="18px",e.textAlign="right",e.fillText(h.toFixed(2),this.curvesize-this.curve_padding.x,this.curve_padding.y-10),e.textAlign="left",e.fillText(l.toFixed(2),this.curve_padding.x,this.curve_padding.y+1*i+23)}},renderCurveValues:function(e,t){for(var s=[],i=1/(t=Math.max(t,1)),a={x:0,y:0},r={x:0,y:0},n={x:1,y:1},o=1e-4,c=0;Math.ceil(c)<=1;c+=.015){for(var h=this.bezier(c,r,e.p1,e.p2,n);o<=h.x;){var l=a.y+(h.y-a.y)*((o-a.x)/(h.x-a.x));this.getCurveCanvasPoint({x:o,y:l});o+=i,s.push(l)}a=h}for(;s.length<t+1;)s.push(1);return s},lerp:function(e,t,s){return e+s*(t-e)},getCurveCanvasPoint:function(e){var t=this.curvesize-2*this.curve_padding.x,s=this.curvesize-2*this.curve_padding.y;return{x:this.curve_padding.x+e.x*t,y:this.curve_padding.y+(1-e.y)*s}},drawPoint:function(e,t,s,i){e.fillStyle=i,e.fillRect(t.x-s/2,t.y-s/2,s,s)},getStateStorageStruct:function(){for(var e=this.boxes.length,t=1;t<e;t++)this.boxes[t].at=0;return{version:this.file_version,device:this.device,switcher:this.switcher,fps:this.fps,macro_index:this.macro_index,settings:this.settings}},handleFileBtn:function(e){var t=e.target;if("save_settings_btn"==t.id){var s=prompt("Download settings as","settings");null!=s&&this.saveFile(s+".json",JSON.stringify({state:this.getStateStorageStruct(),animations:this.animation_presets}))}else"clear_settings"==t.id&&(this.storeData("settings",0),this.storeData("animations",0),this.device=0,this.switcher=0,this.fps=30,this.macro_index="",this.settings={},this.restoreState(),this.setMenuOptions(),this.setStage("from"),this.drawCurve())},handleCurvePresetBtn:function(e){var t=e.target,s=t.tagName.toLowerCase();if("svg"==s||"path"==s||"line"==s)t=t.closest("button");else if("button"!==s)return;var i=t.id,a={linear:{p1:{x:.33,y:.33},p2:{x:.66,y:.66}},easeInSine:{p1:{x:.12,y:0},p2:{x:.39,y:0}},easeOutSine:{p1:{x:.61,y:1},p2:{x:.88,y:1}},easeInOutSine:{p1:{x:.37,y:0},p2:{x:.63,y:1}},easeInQuad:{p1:{x:.11,y:0},p2:{x:.5,y:0}},easeOutQuad:{p1:{x:.5,y:1},p2:{x:.89,y:1}},easeInOutQuad:{p1:{x:.45,y:0},p2:{x:.55,y:1}},easeInCubic:{p1:{x:.32,y:0},p2:{x:.67,y:0}},easeOutCubic:{p1:{x:.33,y:1},p2:{x:.68,y:1}},easeInOutCubic:{p1:{x:.65,y:0},p2:{x:.35,y:1}},easeInQuart:{p1:{x:.5,y:0},p2:{x:.75,y:0}},easeOutQuart:{p1:{x:.25,y:1},p2:{x:.5,y:1}},easeInOutQuart:{p1:{x:.76,y:0},p2:{x:.24,y:1}},easeInQuint:{p1:{x:.64,y:0},p2:{x:.78,y:0}},easeOutQuint:{p1:{x:.22,y:1},p2:{x:.36,y:1}},easeInOutQuint:{p1:{x:.83,y:0},p2:{x:.17,y:1}},easeInExpo:{p1:{x:.7,y:0},p2:{x:.84,y:0}},easeOutExpo:{p1:{x:.16,y:1},p2:{x:.3,y:1}},easeInOutExpo:{p1:{x:.87,y:0},p2:{x:.13,y:1}},easeInCirc:{p1:{x:.55,y:0},p2:{x:1,y:.45}},easeOutCirc:{p1:{x:0,y:.55},p2:{x:.45,y:1}},easeInOutCirc:{p1:{x:.85,y:0},p2:{x:.15,y:1}},easeInBack:{p1:{x:.36,y:0},p2:{x:.66,y:-.56}},easeOutBack:{p1:{x:.34,y:1.56},p2:{x:.64,y:1}},easeInOutBack:{p1:{x:.68,y:-.6},p2:{x:.32,y:1.6}}};i in a&&(this.current_pts.p1=a[i].p1,this.current_pts.p2=a[i].p2,this.drawCurve())},saveFile:function(e,t){if(this.debug){var s=document.createElement("pre");return s.textContent=t,s.classList.add("debug"),body.appendChild(s),void(s.onclick=function(e){body.removeChild(s)})}var i=document.createElement("a");document.body.appendChild(i),i.style="display: none",blob=new Blob([t],{type:"octet/stream"}),url=window.URL.createObjectURL(blob),i.href=url,i.download=e,i.click(),window.URL.revokeObjectURL(url),i.parentElement.removeChild(i)},loadFile:function(e){window.FileReader||alert("FileReader not supported by this browser");var t=new FileReader,s=this;t.onload=function(e){if(2==e.target.readyState)if(e.target.error)alert("Error while reading file");else{try{var t=JSON.parse(e.target.result)}catch(e){return void alert("Error while reading JSON")}s.restoreState(t)}},t.readAsText(e.target.files[0])},handleSaveMacro:function(e){var t=this.save_macro_stuff.querySelector("#save_macro_btn"),s=this.save_macro_stuff.querySelector("#macro_name").value.replace(/^\s+|\s+$/gm,""),i=+this.save_macro_stuff.querySelector("#macro_index").value;"click"==e.type?e.target==t&&this.generateMacro(s,i):s.length&&"number"==typeof i&&i>0&&i<=99?(t.disabled=!1,i!==this.macro_index&&(this.macro_index=i,this.saveState(!0)),"Enter"===e.key||e.keyCode):t.disabled=!0},generateMacro:function(e,t){var s,i=this.devices[this.device].name,a=this.renderFrames(),r=a.rendered_frames,n=a.max_frames,o=r.length,c={},h=this.getDeviceCapabilities(this.device),l=this.switcher.substring(2)-1,d='<?xml version="1.0" encoding="UTF-8"?><Profile majorVersion="1" minorVersion="5" product="'+i+'">\n\t<MacroPool>\n\t\t<Macro index="'+(t-1)+'" name="'+e+'" description="">\n\n';for(d+="\t\t\t\x3c!-- on air status --\x3e\n",s=1;s<this.boxes.length;s++)"supersource"==this.boxes[s].type?this.boxes[s].enabled?d+='\t\t\t<Op id="SuperSourceV2BoxEnable" superSource="0" boxIndex="'+(s-h.keyers-1)+'" enable="True"/>\n':d+='\t\t\t<Op id="SuperSourceV2BoxEnable" superSource="0" boxIndex="'+(s-h.keyers-1)+'" enable="False"/>\n':d+='\t\t\t<Op id="KeyOnAir" mixEffectBlockIndex="'+l+'" keyIndex="'+(s-1)+'" onAir="False"/>\n',d+="\n";for(d+="\t\t\t\x3c!-- mask status --\x3e\n",s=1;s<o;s++)this.boxes[s].enabled&&("supersource"==this.boxes[s].type?d+='\t\t\t<Op id="SuperSourceV2BoxMaskEnable" superSource="0" boxIndex="'+(s-h.keyers-1)+'" enable="True"/>\n':d+='\t\t\t<Op id="DVEKeyMaskEnable" mixEffectBlockIndex="'+l+'" keyIndex="'+(s-1)+'" enable="True"/>\n',d+="\n");for(d+="\n",d+="\t\t\t\x3c!-- source status --\x3e\n",s=1;s<o;s++)this.boxes[s].enabled&&0!=this.boxes[s].src&&("supersource"==this.boxes[s].type?d+='\t\t\t<Op id="SuperSourceV2BoxInput" superSource="0" boxIndex="'+(s-h.keyers-1)+'" input="'+this.boxes[s].src+'"/>\n':d+='\t\t\t<Op id="KeyFillInput" mixEffectBlockIndex="'+l+'" keyIndex="'+(s-1)+'" input="'+this.boxes[s].src+'"/>\n',d+="\n");for(var p=0;p<n;p++){for(s=1;s<o;s++){var u=r[s];for(prop in u){var m=u[prop];if(p<m.length){var v=m[p].toFixed(3);if(s in c||(c[s]={}),!(prop in c[s])||v!=c[s][prop]){var f=s-1;"supersource"==this.boxes[s].type&&(f-=h.keyers),v!=c[s][prop]&&(d+=this.generateMacroOpcode(f,prop,v,this.boxes[s].type,l)),c[s][prop]=v}}}d+="\n"}if(d+='\t\t\t<Op id="MacroSleep" frames="1"/>\n\n',0==p){for(s=1;s<o;s++)this.boxes[s].enabled&&"keyers"==this.boxes[s].type&&(d+='\t\t\t<Op id="KeyOnAir" mixEffectBlockIndex="'+l+'" keyIndex="'+(s-1)+'" onAir="True"/>\n');d+='\t\t\t<Op id="MacroSleep" frames="1"/>\n\n'}}for(s=1;s<o;s++)this.boxes[s].enabled&&this.boxes[s].type;d+="\t\t</Macro>\n\t</MacroPool>\n</Profile>",this.saveFile(e+".xml",d)},generateMacroOpcode:function(e,t,s,i,a){if("supersource"==i)var r='\t\t\t<Op id="'+(n={x:{id:"SuperSourceV2BoxXPosition",attr:"xPosition"},y:{id:"SuperSourceV2BoxYPosition",attr:"yPosition"},scale:{id:"SuperSourceV2BoxSize",attr:"size"},cropL:{id:"SuperSourceV2BoxMaskLeft",attr:"left"},cropT:{id:"SuperSourceV2BoxMaskTop",attr:"top"},cropR:{id:"SuperSourceV2BoxMaskRight",attr:"right"},cropB:{id:"SuperSourceV2BoxMaskBottom",attr:"bottom"}})[t].id+'" superSource="0" boxIndex="'+e+'" '+n[t].attr+'="'+s+'"/>\n';else{var n;r='\t\t\t<Op id="'+(n={x:{id:"DVEAndFlyKeyXPosition",attr:"xPosition"},y:{id:"DVEAndFlyKeyYPosition",attr:"yPosition"},scale:{id:"DVEAndFlyKeyXSize",attr:"xSize"},scaleY:{id:"DVEAndFlyKeyYSize",attr:"ySize"},cropL:{id:"DVEKeyMaskLeft",attr:"left"},cropT:{id:"DVEKeyMaskTop",attr:"top"},cropR:{id:"DVEKeyMaskRight",attr:"right"},cropB:{id:"DVEKeyMaskBottom",attr:"bottom"}})[t].id+'" mixEffectBlockIndex="'+a+'" keyIndex="'+e+'" '+n[t].attr+'="'+s+'"/>\n';"scale"==t&&(r+=this.generateMacroOpcode(e,"scaleY",s,i,a))}return r},updateAnimationList:function(){this.animations_list_elem.innerHTML="",this.selected_animation=0;for(var e=1;e<this.animations_list.length;e++){var t=document.createElement("li");t.appendChild(document.createTextNode(this.animations_list[e].name)),t.setAttribute("id","item_"+e),this.animations_list_elem.appendChild(t)}},setBoxToggles:function(){this.getDeviceCapabilities(this.device);var e=document.getElementById("boxes");for(i=1;i<this.boxes.length;i++){var t=e.querySelector("#box"+i);this.boxes[i].enabled?t.checked=!0:t.checked=!1}},formatAnimation:function(){for(var e=this.animations_list[this.selected_animation].boxes,t=this.animations_list[this.selected_animation].name,s=function(e){var t="{ ",i=Object.keys(e).length;for(var a in e){var r=e[a];"number"==typeof r?t+=a+": "+r.toFixed(3):"object"==typeof r&&(t+=a+": "+s(r)),t+=--i>0?", ":""}return t+" }"},i='presets.push( \n{\tname: switcher + " - '+t+'",\n\tboxes: [\n\t\t0,\n',a=1;a<e.length;a++){var r=e[a];i+="\t\t{";var n=Object.keys(r).length;for(prop in r){i+=("i"==prop?"\t":"\t\t\t")+String(prop).padEnd(6," ")+": ";var o=r[prop],c=typeof o;if("number"==c)i+=o;else if("string"==c)i+='"'+o+'"';else if("boolean"==c)i+=o;else if("object"==c)if("curves"==prop){var h=Object.keys(o).length;for(prop2 in i+="{ ",o)i+="\n\t\t\t\t"+String(prop2).padEnd(6," ")+": "+s(o[prop2])+(--h>0?", ":"");i+="\n\t\t\t}"}else i+=s(o);i+=--n>0?", ":"",i+="\n"}i+="\t\t}",a<e.length-1&&(i+=",\n")}i+="\n\t]\n} );",window.prompt("Copy to clipboard: CMD+C, Enter",i)},handleAnimationListBtns:function(e){if("load_anim"==e.target.id)this.loadAnimation(this.selected_animation);else if("format_anim"==e.target.id)this.loadAnimation(this.selected_animation),this.formatAnimation();else if("save_anim"==e.target.id){if(null!=(s=window.prompt("Save new animation preset as",""))){var t=this.deepClone(this.boxes);this.animations_list.push({name:s,boxes:t}),this.storeData("animations",this.animation_presets),this.updateAnimationList(),this.setAnimationListSelection(this.animations_list.length-1),this.animations_list_elem.focus()}}else if("rename_anim"==e.target.id){var s;if(null!=(s=window.prompt("Rename animation",this.animations_list[this.selected_animation].name))){var i=this.selected_animation;this.animations_list[this.selected_animation].name=s,this.updateAnimationList(),this.setAnimationListSelection(i),this.animations_list_elem.focus(),this.storeData("animations",this.animation_presets)}}else if("delete_anim"==e.target.id){this.animations_list.splice(this.selected_animation,1);var a=0;this.animations_list.length>1&&(a=this.selected_animation>=this.animations_list.length?this.animations_list.length-1:this.selected_animation),this.updateAnimationList(),this.setAnimationListSelection(a),this.storeData("animations",this.animation_presets)}},handleAnimationSelectList:function(e){if("mousedown"==e.type){var t=0;if("LI"==e.target.tagName){t=parseInt(e.target.id.split("_")[1]);if(this.selected_animation==t)return!0}else if(e.clientX>=this.animations_list_elem.offsetWidth-3)return!0;this.setAnimationListSelection(t)}else if("keydown"==e.type){var s=0;return 38==e.keyCode?s=Math.max(1,this.selected_animation-1):40==e.keyCode&&(s=Math.min(this.animations_list.length-1,this.selected_animation+1)),s&&s!=this.selected_animation&&this.setAnimationListSelection(s),38!=e.keyCode&&40!=e.keyCode}this.animations_list_elem.focus()},deepClone:function(e){return JSON.parse(JSON.stringify(e))},setAnimationListSelection:function(e){if(this.selected_animation&&this.animations_list_elem.querySelector(".selected").classList.remove("selected"),e){var t=this.animations_list_elem.querySelector("#item_"+e);t.classList.add("selected");var s=t.offsetTop-this.animations_list_elem.scrollTop;s>this.animations_list_elem.clientHeight-t.clientHeight?this.animations_list_elem.scrollTop=t.offsetTop-this.animations_list_elem.clientHeight+t.clientHeight:s<0&&(this.animations_list_elem.scrollTop=t.offsetTop)}if(!this.selected_animation)for(var i=this.animations_list_elem.parentElement.querySelectorAll("#load_anim, #rename_anim, #delete_anim, #format_anim"),a=0;a<i.length;a++)i[a].disabled=!1;if(!e)for(i=this.animations_list_elem.parentElement.querySelectorAll("#load_anim, #rename_anim, #delete_anim, #format_anim"),a=0;a<i.length;a++)i[a].disabled=!0;this.selected_animation=e}};return e}();window.addEventListener("load",(function(){Generator.init()}));